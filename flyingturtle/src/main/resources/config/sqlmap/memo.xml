<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.flyingturtle.repository.mapper.MemoMapper">
	
	<!-- 메모 과목 조회 -->
	<select id="selectMemoSbj" parameterType="int" resultType="memo" >
		select *
		  from tb_memo_subject
		 where member_no = #{memberNo}
	</select>
	
	<!-- 임시 저장메모 조회 -->
	<select id="selectNonSaveMemo" parameterType="int" resultType="memo">
		select *
		  from tb_memo m
		 where save = 'N'
		   and member_no = #{memberNo}
	</select>
	
	<!-- 임시 메모 등록/작성 -->
	<insert id="insertNoneSaveMemo" parameterType="memo" useGeneratedKeys="true" keyProperty="memoNo">
		INSERT INTO tb_memo (
			`content`, `member_no`, `reg_date`
		) VALUES (
			#{content}, #{memberNo}, now()
		);
	</insert>
	
	<!-- 임시메모 수정 -->
	<update id="updateNonSaveMemo" parameterType="memo">
		update tb_memo
		   set content = #{content}
		 where memo_no = #{memoNo}
	</update>
	 
	 <!-- 임시메모 -> 저장메모 :: 과목선택시 -->
	 <update id="updateMemoSbj" parameterType="memo">
	 	update tb_memo
	 	   set save = 'Y',
	 	       sbj_no = #{sbjNo}
	 	 where memo_no = #{memoNo}
	 </update>
	 
	 
	<!-- ============================ 저장메모 ============================ -->	
	
	<!-- 저장 메모 조회 -->
	<select id="selectSavedMemo" parameterType="memo" resultType="memo">
		select *
		  from tb_memo m
		 where save = 'Y'
		   and member_no = #{memberNo}
		   <if test="sbjNo != 0">
			   and sbj_no = #{sbjNo}
		   </if>
	</select>

	<!-- 메모 등록/작성 -->
	<insert id="insertMemo" parameterType="memo" useGeneratedKeys="true" keyProperty="memoNo">
		INSERT INTO tb_memo (
			`content`,
			`member_no`,
			`sbj_no`,
			`reg_date`
		) VALUES (
			#{content}, 
			#{memberNo},
			#{sbjNo},
			now()
		);
	</insert>
	
	<!-- 메모 삭제(공통) -->
	<delete id="deleteMemo" parameterType="int">
		delete
		  from tb_memo
		 where memo_no = #{memoNo}
	</delete>
	
</mapper>